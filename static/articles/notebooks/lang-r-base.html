<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-04-27 mer. 09:40 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Introduction to R</title>
<meta name="generator" content="Org mode">
<link rel="stylesheet" type="text/css" href="assets/worg.css" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Introduction to R</h1>
<p>
This introduction to the R language aims at understanding how to represent and manipulate data objects as commonly found in data science, to provide basic summary statistic and to build relevant graphical representation of the data [<a href="#ihaka-1996-r">1</a>].
</p>

<p>
<b><b>Important notice:</b></b> Only base commands are discussed here, not the <a href="https://www.tidyverse.org/">tidyverse</a>. A separate cheatsheet is available for the <a href="https://ggplot2.tidyverse.org/">ggplot2</a> package.
</p>

<div id="outline-container-org6db3a1d" class="outline-2">
<h2 id="org6db3a1d"><span class="section-number-2">1</span> Installing R and RStudio</h2>
<div class="outline-text-2" id="text-1">
<p>
The R statistical package can be installed from <a href="https://cran.r-project.org/">CRAN</a>. Be sure to also download <a href="https://www.rstudio.com/">RStudio</a> as it provided a full-featured user interface to interact with R. To use Jupyter notebook, you will also need the <a href="https://irkernel.github.io/">IR kernel</a>.
</p>
</div>

<div id="outline-container-org9a8768a" class="outline-3">
<h3 id="org9a8768a"><span class="section-number-3">1.1</span> Useful additional packages</h3>
<div class="outline-text-3" id="text-1-1">
<p>
This tutorial mainly relies on core facilities that come along so called R <a href="https://stackoverflow.com/a/9705725">base packages</a>. However, it is possible to install additional packages and, in particular, the <a href="https://ggplot2.tidyverse.org/">ggplot2</a> package, as shown below:
</p>

<pre class="example">
install.packages("ggplot2")
</pre>
</div>
</div>

<div id="outline-container-org9b13e61" class="outline-3">
<h3 id="org9b13e61"><span class="section-number-3">1.2</span> Setup</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The following setup will be used for graphical displays:
</p>

<div class="org-src-container">
<pre class="src src-R">library(ggplot2)
theme_set(theme_minimal())
</pre>
</div>

<p>
Note that you need to load the ggplot2 package only once, at the start of your R session.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb215549" class="outline-2">
<h2 id="orgb215549"><span class="section-number-2">2</span> Getting started</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org909d16f" class="outline-3">
<h3 id="org909d16f"><span class="section-number-3">2.1</span> Variables</h3>
<div class="outline-text-3" id="text-2-1">
<p>
There are fundamentally two kind of data structures in statistics-oriented programming languages: numbers and strings. Numbers can be integers or real numbers and they are used to represent values observed for a continuous or discrete statistical variable, while strings are everything else that cannot be represented as numbers or list of numbers, e.g. address of a building, answer to an open-ended question in a survey, etc.
</p>

<p>
Here is how we can create a simple variable, say <code>x</code>, to store a list of 5 numerical values:
</p>

<div class="org-src-container">
<pre class="src src-R">x &lt;- c(1, 3, 2, 5, 4)
</pre>
</div>

<p>
Note that the symbol <code>&lt;-</code> stands for the recommended assignment operator, yet it is possible to use <code>=</code> to assign some quantity to a given variable, which appears on the left hand side of the above expression. Also, the series of values is reported between round brackets, and each values is separated by a comma. From now on, we will talk interchangeably of values or of observations as if we were talking of a measure collected on a statistical unit.
</p>

<p>
Some properties of this newly created variable can be queried online, e.g. how many elements does <code>x</code> has or how those elements are represneted in R:
</p>

<div class="org-src-container">
<pre class="src src-R">length(x)
typeof(x)
</pre>
</div>

<pre class="example">
[1] 5

[1] "double"
</pre>


<p>
It should be noted that x contains values stored as real numbers (<code>double</code>) while they may just be stored as integers. It is however possible to ask R to use truly integer values:
</p>

<div class="org-src-container">
<pre class="src src-R">x &lt;- c(1L, 3L, 2L, 5L, 4L)
typeof(x)
</pre>
</div>

<pre class="example">

[1] "integer"
</pre>


<p>
The distinction between 32 bits integers and reals will not be that important in common analysis tasks, but it is important to keep in mind that it is sometimes useful to check whether data are represented as expected, especially in the case of categorical variables, also called 'factor' in R parlance (more on this latter).
</p>

<p>
The list of numbers we stored in <code>x</code> is called a vector, and it is one of the building block of common R data structures. Oftentimes, we will need richer data structures, especially two-dimensional objects, like matrix or data frame, or higher-dimensional objects such as array or list.
</p>


<div id="org2a6d35e" class="figure">
<p><img src="./assets/lang-r-base-001.png" alt="lang-r-base-001.png" width="640px">
</p>
<p><span class="figure-number">Figure 1: </span>Common data structures in R</p>
</div>
</div>
</div>

<div id="outline-container-org65395eb" class="outline-3">
<h3 id="org65395eb"><span class="section-number-3">2.2</span> Vectors</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The command <code>c</code> ('concatenate') we used to create our list of integers will be very useful when it comes to pass multiple options to a command. It can be nested into another call to <code>c</code> like in the following example:
</p>

<div class="org-src-container">
<pre class="src src-R">x &lt;- c(c(1, 2, 3), c(4, 5, 6), 7, 8)
</pre>
</div>

<p>
In passing, note that since we use the same name for our newly created variable, <code>x</code>, the old content referenced in <code>x</code> (1, 3, 2, 5, 4) is definitively lost. Once you have a vector of values, you can access each item by providing the (one-based) index of the item(s), e.g.:
</p>

<div class="org-src-container">
<pre class="src src-R">x[1]
x[3]
x[c(1,3)]
x[1:3]
</pre>
</div>

<pre class="example">
[1] 1

[1] 3

[1] 1 3

[1] 1 2 3
</pre>


<p>
A convenient shorhand notation for regular sequence of integers is <code>start:end</code>, where <code>start</code> is the starting value and <code>end</code> is the last value (both included). Hence, <code>c(1,2,3,4)</code> is the same as <code>1:4</code>. This is useful when one wants to preview the first 3 or 5 values in a vector, for example. A more general function to work with regular sequence of numbers is <code>seq</code>. Here is an example of use:
</p>

<div class="org-src-container">
<pre class="src src-R">seq(1, 10)
seq(1, 10, by = 2)
seq(0, 10, length = 5)
</pre>
</div>

<pre class="example">
 [1]  1  2  3  4  5  6  7  8  9 10

[1] 1 3 5 7 9

[1]  0.0  2.5  5.0  7.5 10.0
</pre>


<p>
Updating content of a vector can be done directly by assigning a new value to one of the item:
</p>

<div class="org-src-container">
<pre class="src src-R">x[3] &lt;- NA
</pre>
</div>

<p>
In the above statement, the third item has been assigned a missing value, which is coded as <code>NA</code> ('not available') in R. Again, there is no way to go back to the previous state of the variable, so be careful when updating the content of a variable.
</p>

<p>
The presence of missing data is important to check before engaging into any serious statistical stuff. The <code>is.na</code> function can be used to check for the presence of any missing value in a variable, while <code>which</code> will return the index that matches a <code>TRUE</code> result, if any:
</p>

<div class="org-src-container">
<pre class="src src-R">is.na(x)
which(is.na(x))
</pre>
</div>

<pre class="example">
[1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE

[1] 3
</pre>


<p>
Notice that many functions like <code>is.na</code>, or <code>which</code>, act in a vectorized way, meaning that you don't have to iterate manually over each item in the vector. Moreover, function calls can be nested one into the other. In the latter R expression, <code>which</code> is actually processing the values returned by the call to <code>is.na</code>.
</p>
</div>
</div>

<div id="outline-container-orge1eadcc" class="outline-3">
<h3 id="orge1eadcc"><span class="section-number-3">2.3</span> Vectors and random sampling</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The sample function allows to randomly shuffle an existing vector or to generate a sequence of random numbers. Whenever we rely on the random number generator (RNG), it is recommend to set the seed of the RNG in order to ensure that those pseudo-random sequence could be reproduced later. Here is an illustration:
</p>

<div class="org-src-container">
<pre class="src src-R">s &lt;- c(1, 4, 2, 3, 8)
sample(s)
</pre>
</div>

<pre class="example">

[1] 1 4 2 3 8
</pre>


<div class="org-src-container">
<pre class="src src-R">sample(1:10, size = 5)
sample(0:1, size = 10, replace = TRUE)
</pre>
</div>

<pre class="example">
[1]  8  9  1  2 10

 [1] 1 1 0 1 1 0 0 1 0 0
</pre>


<p>
In summary, <code>sample(1:n, size = n)</code> returns a permutation of the <code>n</code> elements, while <code>sample(1:n, size = n, replace = TRUE)</code> provides a bootstrap sample of the original data.
</p>
</div>
</div>

<div id="outline-container-org923e127" class="outline-3">
<h3 id="org923e127"><span class="section-number-3">2.4</span> Sorting</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Sorting a list of values or finding the index or rank of any value in a vector are common tasks in statistical programming. It is different from computing ranks of observed values, which is handled by the <code>rank</code> function. The two main instructions to sort a list of values and to get the index of the sorted item are <code>sort</code> and <code>order</code>, respectively:
</p>

<div class="org-src-container">
<pre class="src src-R">z &lt;- c(1, 6, 7, 2, 8, 3, 9, 4, 5)
sort(z)
order(z)
</pre>
</div>

<pre class="example">

[1] 1 2 3 4 5 6 7 8 9

[1] 1 4 6 8 9 2 3 5 7
</pre>
</div>
</div>

<div id="outline-container-orgd8ef274" class="outline-3">
<h3 id="orgd8ef274"><span class="section-number-3">2.5</span> Data frames</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Data frames are one of the core data structures to store and represent statistical data. Many routine functions that are used to load data stored in flat files or databases or to preprocess data stored in memory rely on data frames. Likewise, graphical commands such as those found in the ggplot2 package generally assumes a data frame as input. The same applies to functions used in statistical modeling (<code>lm</code>, <code>glm</code>, etc.).
</p>

<p>
In a data frame, observations are arranged in rows and variables are arranged in columns. Each variable can be viewed as a single vector, but those variables are all recorded into a common data structure, each with an unique name. Moreover, each column, or variable, can be of a different type&#x2013;numeric, factor, character or boolean, which makes data frame slightly different from 'matrix' object where only values of the same type can be stored.
</p>

<p>
Here is an example of a built-in data frame, readily available by using the command <code>data</code>:
</p>

<div class="org-src-container">
<pre class="src src-R">data(ToothGrowth)
head(ToothGrowth)
</pre>
</div>

<pre class="example">

   len supp dose
1  4.2   VC  0.5
2 11.5   VC  0.5
3  7.3   VC  0.5
4  5.8   VC  0.5
5  6.4   VC  0.5
6 10.0   VC  0.5
</pre>


<div class="org-src-container">
<pre class="src src-R">str(ToothGrowth)
</pre>
</div>

<pre class="example">
'data.frame':	60 obs. of  3 variables:
 $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
 $ supp: Factor w/ 2 levels "OJ","VC": 2 2 2 2 2 2 2 2 2 2 ...
 $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...
</pre>


<p>
While <code>head</code> allows to preview the first 6 lines of a data frame, <code>str</code> provides a concise overview of what's available in the data frame, namely: the name of each variable (column), its mode of representation, et the first 10 observations (values).
</p>

<p>
The dimensions (number of lines and columns) of a data frame can be verified using <code>dim</code> (a shortcut for the combination of <code>nrows</code> and <code>ncols</code>):
</p>

<div class="org-src-container">
<pre class="src src-R">dim(ToothGrowth)
</pre>
</div>

<pre class="example">
[1] 60  3
</pre>


<p>
To access any given cell in this data frame, we will use the indexing trick we used in the case of vectors, but this time we have to indicate the line number as well as the column number, or name: Hence, <code>ToothGrowth[i,j]</code> means the value located at line <code>i</code> and column <code>j</code>, while <code>ToothGrowth[c(a,b),j]</code> would mean values at line <code>a</code> and <code>b</code> for the same column <code>j</code>.
</p>


<div id="org71c197e" class="figure">
<p><img src="./assets/lang-r-base-002.png" alt="lang-r-base-002.png" width="320px">
</p>
<p><span class="figure-number">Figure 2: </span>Representation of a data frame in R</p>
</div>

<p>
Here is how we can retrieve the second observation in the first column:
</p>

<div class="org-src-container">
<pre class="src src-R">ToothGrowth[2,1]
</pre>
</div>

<pre class="example">
[1] 11.5
</pre>


<p>
Since the columns of a data frame have names, it is equivalent to use <code>ToothGrowth[2,1]</code> and <code>ToothGrowth[2,"len"]</code>. In the latter case, variable names must be quoted. Column names can be displayed using <code>colnames</code> or <code>names</code> (in the special case of data frames), while row names are available via <code>rownames</code>. Row names can be used as unique identifier for statistical units, but best practice is usually to store unique IDs as characters or factor levels in a dedicated column in the data frame.
</p>

<p>
Since we know that we can use c to create a list of numbers, we can use <code>c</code> to create a list of line numbers to look for. Imagine you want to access the content of a given column (<code>len</code>, which is the first column, numbered 1), for lines 2 and 4: (<code>c(2, 4)</code>):
</p>


<div id="orga6c4b24" class="figure">
<p><img src="./assets/lang-r-base-003.png" alt="lang-r-base-003.png" width="320px">
</p>
<p><span class="figure-number">Figure 3: </span>Vector indexing</p>
</div>

<p>
Here is how we would do in R:
</p>

<div class="org-src-container">
<pre class="src src-R">ToothGrowth[c(2,4),1]
</pre>
</div>

<pre class="example">
[1] 11.5  5.8
</pre>


<p>
This amounts to 'indexed selection', meaning that we need to provide the row (or column) numbers, while most of the time we are interested in criterion-based indexation, that is: "which observation fullfills a given criterion." We generally call this a 'filter'. Since most R operations are vectorized, this happens to be really easy. For instance, to display observations on <code>supp</code> that satisfy the condition <code>len &gt; 6</code>, we would use:
</p>

<div class="org-src-container">
<pre class="src src-R">head(ToothGrowth$supp[ToothGrowth$len &gt; 6])
</pre>
</div>

<pre class="example">
[1] VC VC VC VC VC VC
Levels: OJ VC
</pre>



<div id="orgd1ea4b6" class="figure">
<p><img src="./assets/lang-r-base-004.png" alt="lang-r-base-004.png" width="320px">
</p>
<p><span class="figure-number">Figure 4: </span>Selecting elements in a data frame</p>
</div>

<p>
Likewise, it is possible to combine different filters using logical operators: <code>&amp;</code> stands for 'and' (logical conjunction) and <code>|</code> stands for 'or' (logical disjonction); logical equality is denoted as <code>==</code> while its negation reads <code>!=</code>. Here is an example where we want to select observations that satisfy a given condition on both the <code>dose</code> (dose = 0.5) and <code>len</code> (len &gt; 10) variables:
</p>


<div id="org04cc668" class="figure">
<p><img src="./assets/lang-r-base-005.png" alt="lang-r-base-005.png" width="320px">
</p>
<p><span class="figure-number">Figure 5: </span>Using filters on a data frame</p>
</div>

<p>
In R, we would write:
</p>

<div class="org-src-container">
<pre class="src src-R">ToothGrowth[ToothGrowth$len &gt; 10 &amp; ToothGrowth$dose &lt; 1,]
</pre>
</div>

<pre class="example">
    len supp dose
2  11.5   VC  0.5
7  11.2   VC  0.5
8  11.2   VC  0.5
31 15.2   OJ  0.5
32 21.5   OJ  0.5
33 17.6   OJ  0.5
35 14.5   OJ  0.5
39 16.5   OJ  0.5
</pre>


<p>
You will soon realize that for complex queries this notation become quite cumbersome: all variable must be prefixed by the name of the data frame, which can result in a very long statement. While it is recommended practice for programming or when developing dedicated package, it is easier to rely on <code>subset</code> in an interactive session. The <code>subset</code> command asks for three arguments, namely the name of the data frame we are working on, the rows we want to select (or filter), and the columns we want to return. The result of a call to <code>subset</code> is always a data frame.
</p>


<div id="org8569538" class="figure">
<p><img src="./assets/lang-r-base-006.png" alt="lang-r-base-006.png" width="320px">
</p>
<p><span class="figure-number">Figure 6: </span>Subsetting a data frame by row and column</p>
</div>

<p>
Here is an example of use:
</p>

<div class="org-src-container">
<pre class="src src-R">subset(ToothGrowth, len &gt; 10 &amp; dose &lt; 1)
</pre>
</div>

<pre class="example">
    len supp dose
2  11.5   VC  0.5
7  11.2   VC  0.5
8  11.2   VC  0.5
31 15.2   OJ  0.5
32 21.5   OJ  0.5
33 17.6   OJ  0.5
35 14.5   OJ  0.5
39 16.5   OJ  0.5
</pre>



<div id="orgae8207e" class="figure">
<p><img src="./assets/lang-r-base-007.png" alt="lang-r-base-007.png" width="320px">
</p>
<p><span class="figure-number">Figure 7: </span>Subsetting a data frame: Illustration of joint filters</p>
</div>


<p>
It is also possible to use the technique discussed in the case of vectors to sort a data frame in ascending or descending order according to one or more variables. Here is an example using the <code>len</code> variable:
</p>

<div class="org-src-container">
<pre class="src src-R">head(ToothGrowth)
head(ToothGrowth[order(ToothGrowth$len),])
</pre>
</div>

<pre class="example">
   len supp dose
1  4.2   VC  0.5
2 11.5   VC  0.5
3  7.3   VC  0.5
4  5.8   VC  0.5
5  6.4   VC  0.5
6 10.0   VC  0.5

   len supp dose
1  4.2   VC  0.5
9  5.2   VC  0.5
4  5.8   VC  0.5
5  6.4   VC  0.5
10 7.0   VC  0.5
3  7.3   VC  0.5
</pre>

<p>
The <code>which</code> function can also be used to retrieve a specific observation in a data frame, like in the following instruction:
</p>

<div class="org-src-container">
<pre class="src src-R">which(ToothGrowth$len &lt; 8)
</pre>
</div>

<pre class="example">
[1]  1  3  4  5  9 10
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb4c277" class="outline-2">
<h2 id="orgeb4c277"><span class="section-number-2">3</span> Statistical summaries</h2>
<div class="outline-text-2" id="text-3">
<p>
As explained above, the <code>str</code> function is useful to check a given data structure, and individual properties of a data frame can be queried using dedicated functions, e.g. <code>nrow</code> or <code>ncol</code>. Now, to compute statistical quantities on a variable, we can use dedicated functions like <code>mean</code> (arithmetical mean), <code>sd</code> (standard deviation; see also <code>var</code>), <code>IQR</code> (interquartile range), <code>range</code> (range of values; see also <code>min</code> and <code>max</code>), or the <code>summary</code> function, which computes a five-point summary in the case of a numerical variable or a table of counts for categorical outcomes.
</p>
</div>

<div id="outline-container-orgb12cf40" class="outline-3">
<h3 id="orgb12cf40"><span class="section-number-3">3.1</span> Univariate case</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Here are some applications in the case we are interested in summarizing one variable at a time:
</p>

<div class="org-src-container">
<pre class="src src-R">mean(ToothGrowth$len)
range(ToothGrowth$len)
c(min(ToothGrowth$len), max(ToothGrowth$len))
table(ToothGrowth$dose)
</pre>
</div>

<pre class="example">
[1] 18.81333

[1]  4.2 33.9

[1]  4.2 33.9

0.5   1   2 
 20  20  20
</pre>


<p>
summary(ToothGrowth)
</p>

<p>
Of course, the above functions can be applied to a subset of the original data set:
</p>

<div class="org-src-container">
<pre class="src src-R">mean(ToothGrowth$len[ToothGrowth$dose == 1])
table(ToothGrowth$dose[ToothGrowth$len &lt; 20])
</pre>
</div>

<pre class="example">
[1] 19.735

0.5   1   2 
 19  11   1
</pre>
</div>
</div>

<div id="outline-container-org7213327" class="outline-3">
<h3 id="org7213327"><span class="section-number-3">3.2</span> Bivariate case</h3>
<div class="outline-text-3" id="text-3-2">
<p>
If we want to summarize a numerical variable according the values that a factor variable takes, we can use <code>tapply</code> or <code>aggregate</code>. The latter expects a 'formula' describing the relation between the variables we are interested in: the response variable or outcome appears on the left-hand side (LHS), while the factors or descriptors are listed in the right-hand side (RHS). The last argument to <code>aggregate</code> is the function we want to apply to each chunk of observations defined by the RHS. Here is an example of use:
</p>

<div class="org-src-container">
<pre class="src src-R">aggregate(len ~ dose, data = ToothGrowth, mean)
aggregate(len ~ supp + dose, data = ToothGrowth, mean)
</pre>
</div>

<pre class="example">
  dose    len
1  0.5 10.605
2  1.0 19.735
3  2.0 26.100

  supp dose   len
1   OJ  0.5 13.23
2   VC  0.5  7.98
3   OJ  1.0 22.70
4   VC  1.0 16.77
5   OJ  2.0 26.06
6   VC  2.0 26.14
</pre>

<p>
Note that only one function can be applied to the 'formula'. Even if it possible to write a custom function that computes the mean and standard deviation of a variable, both results will be returned as single column in the data frame returned by <code>aggregate</code>. There do exist other ways to perform such computation, though (see, e.g., the <code>plyr</code>, <code>dplyr</code> or <code>Hmisc</code> packages, to name a few), if the results are to be kept in separate variables for later. This, however, does not preclude from using <code>aggregate</code> for printing multivariate results in the console:
</p>

<div class="org-src-container">
<pre class="src src-R">aggregate(len ~ dose, data = ToothGrowth, summary)
f &lt;- function(x) c(mean = mean(x), sd = sd(x))
aggregate(len ~ dose, data = ToothGrowth, f)
</pre>
</div>

<pre class="example">
  dose len.Min. len.1st Qu. len.Median len.Mean len.3rd Qu. len.Max.
1  0.5    4.200       7.225      9.850   10.605      12.250   21.500
2  1.0   13.600      16.250     19.250   19.735      23.375   27.300
3  2.0   18.500      23.525     25.950   26.100      27.825   33.900

  dose  len.mean    len.sd
1  0.5 10.605000  4.499763
2  1.0 19.735000  4.415436
3  2.0 26.100000  3.774150
</pre>


<p>
The <code>table</code> functions also works with two (or even three) variables:
</p>

<div class="org-src-container">
<pre class="src src-R">table(ToothGrowth$dose, ToothGrowth$supp)
</pre>
</div>

<pre class="example">

    OJ VC
0.5 10 10
1   10 10
2   10 10
</pre>


<p>
If formulas are to be preferred, the <code>xtabs</code> function provides a convenient replacement for <code>table</code>:
</p>

<div class="org-src-container">
<pre class="src src-R">xtabs(~ dose + supp, data = ToothGrowth)
</pre>
</div>

<pre class="example">
     supp
dose  OJ VC
  0.5 10 10
  1   10 10
  2   10 10
</pre>


<p>
In either case, frequencies can be computed from the table of counts using <code>prop.table</code>, using the desired margin (row=1, column=2) in the bivariate case:
</p>

<div class="org-src-container">
<pre class="src src-R">prop.table(table(ToothGrowth$dose))
prop.table(table(ToothGrowth$dose, ToothGrowth$supp), margins = 1)
</pre>
</div>

<pre class="example">

      0.5         1         2 
0.3333333 0.3333333 0.3333333

Erreur dans prop.table(table(ToothGrowth$dose, ToothGrowth$supp), margins = 1) : 
  argument inutilisé (margins = 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a37e45" class="outline-2">
<h2 id="org0a37e45"><span class="section-number-2">4</span> Practical use case: The ESS survey</h2>
<div class="outline-text-2" id="text-4">
<p>
The <a href="data/">data</a> directory includes three <a href="https://www.rdocumentation.org/packages/base/versions/3.5.3/topics/readRDS">RDS</a> files related to the <a href="https://www.europeansocialsurvey.org/">European Social Survey</a> (ESS). This survey first ran in 2002 (round 1), and it is actually renewed every two years. The codebook can be downloaded, along <a href="http://www.europeansocialsurvey.org/data/download.html">other data sheets</a>, on the main website.
</p>

<p>
There are two files related to data collected in France (round 1 or rounds 1-5, <code>ess-*-fr.rds</code>) and one file for all participating countries (<a href="data/ess-one-round.rds">ess-one-round.rds</a>).
French data
</p>

<p>
Assuming the <code>data</code> directory is available in the current working directory, here is how we can load French data for round 1:
</p>

<div class="org-src-container">
<pre class="src src-R">WD &lt;- "."
filepath &lt;- paste0(WD, "/data/ess-one-round-fr.rds")
d &lt;- readRDS(filepath)
head(as.data.frame(d[1:10]))
</pre>
</div>

<pre class="example">

       name essround edition   proddate cntry  idno tvtot tvpol rdtot rdpol
1 ESS1e06_6        1     6.6 01.12.2018    FR 10001     3     2     1     0
2 ESS1e06_6        1     6.6 01.12.2018    FR 10002     4     3     2     2
3 ESS1e06_6        1     6.6 01.12.2018    FR 10003     0    NA     7     4
4 ESS1e06_6        1     6.6 01.12.2018    FR 10004     5     2     1     0
5 ESS1e06_6        1     6.6 01.12.2018    FR 10005     2     2     0    NA
6 ESS1e06_6        1     6.6 01.12.2018    FR 10006     3     2     0    NA
</pre>


<div class="org-src-container">
<pre class="src src-R">table(d$yrbrn)
</pre>
</div>

<pre class="example">

1905 1909 1911 1912 1913 1914 1915 1916 1917 1918 1919 1920 1921 1922 1923 1924 1925 1926 1927 1928 
   1    1    2    3    1    3    3    3    1    2    4    9   10   13   10    9   14   15   10   22 
1929 1930 1931 1932 1933 1934 1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 1945 1946 1947 1948 
  13   18   17   16   22   21   19   23   17   22   14   21   14   28   21   23   18   20   30   30 
1949 1950 1951 1952 1953 1954 1955 1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 1966 1967 1968 
  18   28   24   31   25   29   17   30   29   20   20   16   22   25   37   19   28   34   32   27 
1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 
  30   28   35   30   21   29   23   25   23   23   25   27   23   27   14   20   20   16    5    5
</pre>


<div class="org-src-container">
<pre class="src src-R">summary(d$agea)
</pre>
</div>

<pre class="example">
 Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
15.00   32.00   46.00   47.32   61.00   98.00
</pre>


<p>
Let us focus on the following list of variables, readily available in the file <a href="data/ess-one-round-29vars-fr.rds">ess-one-round-29vars-fr.rds</a>:
</p>

<ul class="org-ul">
<li><code>tvtot</code>: TV watching, total time on average weekday</li>
<li><code>rdtot</code>: Radio listening, total time on average weekday</li>
<li><code>nwsptot</code>: Newspaper reading, total time on average weekday</li>
<li><code>polintr</code>: How interested in politics</li>
<li><code>trstlgl</code>: Trust in the legal system</li>
<li><code>trstplc</code>: Trust in the police</li>
<li><code>trstplt</code>: Trust in politicians</li>
<li><code>vote</code>: Voted last national election</li>
<li><code>happy</code>: How happy are you</li>
<li><code>sclmeet</code>: How often socially meet with friends, relatives or colleagues</li>
<li><code>inmdisc</code>: Anyone to discuss intimate and personal matters with</li>
<li><code>sclact</code>: Take part in social activities compared to others of same age</li>
<li><code>health</code>: Subjective general health</li>
<li><code>ctzcntr</code>: Citizen of country</li>
<li><code>brncntr</code>: Born in country</li>
<li><code>facntr</code>: Father born in country</li>
<li><code>mocntr</code>: Mother born in country</li>
<li><code>hhmmb</code>: Number of people living regularly as member of household</li>
<li><code>gndr</code>: Gender</li>
<li><code>yrbrn</code>: Year of birth</li>
<li><code>agea</code>: Age of respondent, calculated</li>
<li><code>edulvla</code>: Highest level of education</li>
<li><code>eduyrs</code>: Years of full-time education completed</li>
<li><code>pdjobyr</code>: Year last in paid job</li>
<li><code>wrkctr</code>: Employment contract unlimited or limited duration</li>
<li><code>wkhct</code>: Total contracted hours per week in main job overtime excluded</li>
<li><code>marital</code>: Legal marital status</li>
<li><code>martlfr</code>: Legal marital status, France</li>
<li><code>lvghw</code>: Currently living with husband/wife</li>
</ul>
</div>

<div id="outline-container-org0504fa4" class="outline-3">
<h3 id="org0504fa4"><span class="section-number-3">4.1</span> Recoded French data</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Note that variables in the file <a href="data/ess-one-round-29vars-fr.rds">ess-one-round-29vars-fr.rds</a> have been recoded and categorical variables now have proper labels. See the script file <a href="scripts/ess-one-round-29vars-fr.r">ess-one-round-29vars-fr.r</a> to see what has been done to the base file.
</p>

<div class="org-src-container">
<pre class="src src-R">filepath &lt;- paste0(WD, "/data/ess-one-round-29vars-fr.rds")
d29 &lt;- readRDS(filepath)
head(d29)
</pre>
</div>

<pre class="example">

                               tvtot              rdtot            nwsptot               polintr
1  More than 1 hour, up to 1,5 hours Less than 0,5 hour     No time at all Not at all interested
2 More than 1,5 hours, up to 2 hours 0,5 hour to 1 hour Less than 0,5 hour     Hardly interested
3                     No time at all  More than 3 hours 0,5 hour to 1 hour Not at all interested
4 More than 2 hours, up to 2,5 hours Less than 0,5 hour     No time at all      Quite interested
5                 0,5 hour to 1 hour     No time at all     No time at all     Hardly interested
6  More than 1 hour, up to 1,5 hours     No time at all Less than 0,5 hour      Quite interested
  trstlgl         trstplc         trstplt vote happy              sclmeet inmdisc         sclact
1       6               8               5 &lt;NA&gt;    10                 &lt;NA&gt;     Yes About the same
2       5               3               3  Yes    10            Every day     Yes About the same
3       5 No trust at all No trust at all  Yes     3            Every day     Yes About the same
4       5               3               3  Yes     6         Once a month     Yes Less than most
5       5               8 No trust at all &lt;NA&gt;    10 Several times a week      No More than most
6       7               8               7 &lt;NA&gt;     5                Never     Yes About the same
     health ctzcntr brncntr facntr mocntr hhmmb   gndr yrbrn agea
1      Good      No      No     No    Yes     2 Female  1940   63
2      Good     Yes     Yes    Yes    Yes     2   Male  1967   36
3 Very good     Yes     Yes     No    Yes     5   Male  1967   36
4      Fair     Yes     Yes    Yes    Yes     1 Female  1926   77
5      Fair     Yes      No     No     No     3 Female  1921   82
6      Fair     Yes     Yes    Yes    Yes     2   Male  1951   52
                                          edulvla eduyrs pdjobyr wrkctr wkhct marital   martlfr
1 Less than lower secondary education (ISCED 0-1)     10    1997   &lt;NA&gt;    35    &lt;NA&gt;   Married
2   Upper secondary education completed (ISCED 3)     12      NA   &lt;NA&gt;    35    &lt;NA&gt;   Married
3   Upper secondary education completed (ISCED 3)     20      NA   &lt;NA&gt;    NA    &lt;NA&gt;   Married
4 Less than lower secondary education (ISCED 0-1)      8    1974   &lt;NA&gt;    25    &lt;NA&gt;   Widowed
5 Less than lower secondary education (ISCED 0-1)      0      NA   &lt;NA&gt;    NA    &lt;NA&gt;   Widowed
6   Upper secondary education completed (ISCED 3)     17    2001   &lt;NA&gt;    48    &lt;NA&gt; Separated
  lvghw
1   Yes
2   Yes
3   Yes
4  &lt;NA&gt;
5  &lt;NA&gt;
6  &lt;NA&gt;
</pre>

<p>
First, let us look at the distribution of the <code>gndr</code> variable, using a simple bar chart:
</p>

<div class="org-src-container">
<pre class="src src-R">summary(d29$gndr)
</pre>
</div>

<pre class="example">
Male Female 
 679    824
</pre>


<div class="org-src-container">
<pre class="src src-R">p &lt;- ggplot(data = d29, aes(x = gndr)) +
  geom_bar() +
  labs(x = "Sex of respondant", y = "Counts")
p
</pre>
</div>


<div class="figure">
<p><img src="assets/lang-r-base-008.png" alt="lang-r-base-008.png">
</p>
</div>

<p>
Now, let's look at the distribution of age. The ggplot2 package offers a <code>geom_density</code> function but it is also possible to draw a line using the precomputed empirical density function, or to let ggplot2 compute the density function itself using the <code>stat=</code> option. Here is how it looks:
</p>

<div class="org-src-container">
<pre class="src src-R">summary(d29$agea)
</pre>
</div>

<pre class="example">
 Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
15.00   32.00   46.00   47.32   61.00   98.00
</pre>


<div class="org-src-container">
<pre class="src src-R">p &lt;- ggplot(data = d29, aes(x = agea)) +
  geom_line(stat = "density", bw = 2) +
  labs(x = "Age of respondant")
p
</pre>
</div>


<div class="figure">
<p><img src="assets/lang-r-base-009.png" alt="lang-r-base-009.png">
</p>
</div>

<p>
The distribution of age can also be represented as an histogram, and ggplot2 makes it quite easy to split the display depending on the sex of the respondants, which is called a 'facet' in ggplot2 parlance:
</p>

<div class="org-src-container">
<pre class="src src-R">p &lt;- ggplot(data = d29, aes(x = agea)) +
  geom_histogram(binwidth = 5) +
  facet_grid(~ gndr) +
  labs(x = "Age of respondant")
p
</pre>
</div>


<div class="figure">
<p><img src="assets/lang-r-base-010.png" alt="lang-r-base-010.png">
</p>
</div>


<p>
Finally, a boxplot might also be an option, especially when we want to compare the distribution of a numerical variable across levels of a categorical variable. The <code>coord_flip</code> instruction is used to swap the X and Y axes, but keep in mind that <code>x=</code> and <code>y=</code> labels still refer to the <code>x</code> and <code>y</code> variable defined in the <code>aes</code>:
</p>

<div class="org-src-container">
<pre class="src src-R">p &lt;- ggplot(data = d29, aes(x = gndr, y = agea)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = NULL, y = "Age of respondants")
p
</pre>
</div>


<div class="figure">
<p><img src="assets/lang-r-base-011.png" alt="lang-r-base-011.png">
</p>
</div>

<p>
<b><b>Sidenote:</b></b> In the above instructions, we used the following convention to build a ggplot2 object:
</p>

<ul class="org-ul">
<li>we assign to a variable, say <code>p</code>, the call to ggplot2 plus any further instructions ('geom', 'scale', 'coord_', etc.) using the <code>+</code> operator;</li>
<li>we use only one <code>aes</code> structure, when calling <code>ggplot</code>, so that it makes it clear what are the data and what variables are used;</li>
<li>we display the graph at the end, by simpling calling our variable <code>p</code>.</li>
</ul>

<p>
Yet, it is possible to proceed in many different ways, depending on your taste and needs. The following instructions are all valid expressions and will yield the same result:
</p>

<pre class="example">
ggplot(data = d29, aes(x = gndr, y = agea, color = vote)) + geom_boxplot()

p &lt;- ggplot(data = d29, aes(x = gndr, y = agea, color = vote))
p &lt;- p + geom_boxplot() + labs(x = "Gender")
p

p &lt;- ggplot(data = d29, aes(x = gndr, y = agea))
p + geom_boxplot(aes(color = vote)) + labs(x = "Gender")
</pre>

<p>
Moreover, it is also possible to use the quick one-liner version of <code>ggplot</code>, namely <code>qplot</code>:
</p>

<pre class="example">
qplot(x = gndr, y = agea, data = d29, color = vote, geom = "boxplot") + labs(x = "Gender")
</pre>

<p>
or even:
</p>

<pre class="example">
qplot(x = gndr, y = agea, data = d29, color = vote, geom = "boxplot", xlab = "Gender")
</pre>

<p>
Further details are available in the handout <a href="./lang-r-ggplot.html">lang-r-ggplot</a>.
</p>
</div>
</div>

<div id="outline-container-org75d90ac" class="outline-3">
<h3 id="org75d90ac"><span class="section-number-3">4.2</span> Data from other countries</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Data from all other participating countries can be loaded in the same manner:
</p>

<div class="org-src-container">
<pre class="src src-R">filepath &lt;- paste0(WD, "/data/ess-one-round.rds")
db &lt;- readRDS(filepath)
cat("No. observations =", nrow(db), "\n")
table(db$cntry)
</pre>
</div>

<pre class="example">

observations = 40856

  AT   BE   CH   CZ   DE   DK   ES   FI   GB   GR   HU   IE   IL   IT   LU   NL   NO   PL   PT   SE 
2257 1899 2040 1360 2919 1506 1729 2000 2052 2566 1685 2046 2499 1207 1552 2364 2036 2110 1511 1999 
  SI 
1519
</pre>


<p>
Since French data are (deliberately) missing from this dataset, we can append them to the above data frame as follows:
</p>

<div class="org-src-container">
<pre class="src src-R">db &lt;- rbind.data.frame(db, d)
cat("No. observations =", nrow(db), "\n")
</pre>
</div>

<pre class="example">

observations = 42359
</pre>


<div class="org-src-container">
<pre class="src src-R">db$cntry &lt;- factor(db$cntry)
table(db$cntry)
</pre>
</div>

<pre class="example">

  AT   BE   CH   CZ   DE   DK   ES   FI   FR   GB   GR   HU   IE   IL   IT   LU   NL   NO   PL   PT 
2257 1899 2040 1360 2919 1506 1729 2000 1503 2052 2566 1685 2046 2499 1207 1552 2364 2036 2110 1511 
  SE   SI 
1999 1519
</pre>


<p>
Remember that is also possible to use <code>summary</code> with a factor variable to display a table of counts.
</p>

<p>
In this particular case, we are just appending a data frame to another data frame already loaded in memory. This assumes that both share the name columns, of course. Sometimes, another common operation might be performed, an 'inner join' between two data tables. For example, imagine that part of the information is spread out in one data frame, and the rest of the data sits in another data frame. If the two data frames have a common unique ID, it is then easy to merge both data frames using the <code>merge</code> command. Here is a simplified example using the above data, that we will split in two beforehand:
</p>

<pre class="example">
db$id &lt;- 1:nrow(db)
db1 &lt;- db[,c(1:10,ncol(db))]
db2 &lt;- db[,c(11:(ncol(db)-1),ncol(db))]
all &lt;- merge(db1, db2, by = "id")
</pre>

<p>
In case the unique ID is spelled differently in the two data frames, it is possible to replace <code>by</code> with <code>by.x</code> and <code>by.y</code>. Notice that we created a column to store the unique ID (as an integer), since it would be more difficult to use <code>rownames</code> as the key.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6db3a1d">1. Installing R and RStudio</a>
<ul>
<li><a href="#org9a8768a">1.1. Useful additional packages</a></li>
<li><a href="#org9b13e61">1.2. Setup</a></li>
</ul>
</li>
<li><a href="#orgb215549">2. Getting started</a>
<ul>
<li><a href="#org909d16f">2.1. Variables</a></li>
<li><a href="#org65395eb">2.2. Vectors</a></li>
<li><a href="#orge1eadcc">2.3. Vectors and random sampling</a></li>
<li><a href="#org923e127">2.4. Sorting</a></li>
<li><a href="#orgd8ef274">2.5. Data frames</a></li>
</ul>
</li>
<li><a href="#orgeb4c277">3. Statistical summaries</a>
<ul>
<li><a href="#orgb12cf40">3.1. Univariate case</a></li>
<li><a href="#org7213327">3.2. Bivariate case</a></li>
</ul>
</li>
<li><a href="#org0a37e45">4. Practical use case: The ESS survey</a>
<ul>
<li><a href="#org0504fa4">4.1. Recoded French data</a></li>
<li><a href="#org75d90ac">4.2. Data from other countries</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="bibliography">
<h2>References</h2>

<table>

<tr valign="top">
<td align="right" class="bibtexnumber">
[<a name="ihaka-1996-r">1</a>]
</td>
<td class="bibtexitem">
R.&nbsp;Ihaka and R.&nbsp;Gentleman, &ldquo;R: A language for data analysis and graphics,&rdquo;
  <em>Journal of Computational and Graphical Statistics</em>, vol.&nbsp;5, no.&nbsp;3,
  pp.&nbsp;299--314, 1996.

</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
Generated by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.3.1) on 2022-04-27 mer. 09:40 (<a href="mailto:chl@aliquote">chl@aliquote</a>)
</div>
</body>
</html>
