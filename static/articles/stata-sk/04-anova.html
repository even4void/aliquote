<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- 2020-10-15 Thu 09:52 -->
    <meta charset="utf-8">
    <meta name="viewport" content=
    "width=device-width, initial-scale=1">
    <title>Stata : analyse de la variance</title>
    <meta name="generator" content="Org mode">
    <link rel="stylesheet" type="text/css" href=
    "worg.css">
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
    });
    </script>
    <script type="text/javascript" src=
    "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
    <div id="content">
        <h1 class="title">Stata : analyse de la variance</h1>
        <div id="table-of-contents">
            <h2>Table des matières</h2>
            <div id="text-table-of-contents">
                <ul>
                    <li>
                        <a href="#org70c9269">Analyse de variance à
                        un facteur</a>
                        <ul>
                            <li>
                                <a href="#orge12f28f">Modèle
                                d’ANOVA</a>
                            </li>
                            <li>
                                <a href="#org02a761a">Conditions
                                d’application du test</a>
                            </li>
                            <li>
                                <a href="#org5cac94e">Commandes
                                graphiques</a>
                            </li>
                            <li>
                                <a href="#orgf3f330a">Comparaisons
                                multiples</a>
                            </li>
                            <li>
                                <a href="#orgb5487dc">Cas des
                                variances non égales</a>
                            </li>
                            <li>
                                <a href="#org4a5d162">Approche non
                                paramétrique</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#org74392c2">Analyse de variance à
                        plusieurs facteurs</a>
                        <ul>
                            <li>
                                <a href="#orgcac23ed">Utilisation
                                de la commande anova</a>
                            </li>
                            <li>
                                <a href="#org5da5c3a">Définition et
                                analyse de contrastes</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#org87b5f58">Autres plans
                        d’expérience</a>
                        <ul>
                            <li>
                                <a href="#org64d1305">Plan en carré
                                latin</a>
                            </li>
                            <li>
                                <a href="#orga7d88ff">Plan en blocs
                                incomplets équilibrés</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <p>L’analyse de variance (ANOVA), souvent retrouvée dans
        l’exploitation d’un plan d’expérience, peut être dérivée
        dans la plupart des cas à partir des modèles de régression
        vus au <a href="03-glm.html">chapitre 3</a> (et plus tard,
        aux chapitres 9 et 10). Toutefois, une présentation de la
        décomposition des sources de variance et du calcul des
        sommes de carré associées, indépendante de l’approche de
        régression linéaire, est proposée dans ce chapitre,
        d’autant que Stata dispose de commandes spécifiques pour
        les modèles d’ANOVA, en particulier <a href=
        "https://www.stata.com/help.cgi?oneway">oneway</a> et
        <a href=
        "https://www.stata.com/help.cgi?anova">anova</a>.</p>
        <p>Dupont consacre plusieurs chapitres de son excellent
        ouvrage à l’analyse de variance, incluant le cas des
        mesures répétées [<a href=
        "#dupont-2009-statis-model">1</a>].</p>
        <div id="outline-container-org70c9269" class="outline-2">
            <h2 id="org70c9269">Analyse de variance à un
            facteur</h2>
            <div class="outline-text-2" id="text-org70c9269"></div>
            <div id="outline-container-orge12f28f" class=
            "outline-3">
                <h3 id="orge12f28f">Modèle d’ANOVA</h3>
                <div class="outline-text-3" id="text-orge12f28f">
                    <p>Dans l’<a href=
                    "http://biostat.mc.vanderbilt.edu/dupontwd/wddtext/index.html">exemple
                    suivant</a>, tiré de [<a href=
                    "#dupont-2009-statis-model">1</a>], on
                    s’intéresse à la relation entre l’âge des
                    participants à l’étude au moment du diagostique
                    et un polymorphisme de séquence. Les données
                    sont disponibles dans le fichier
                    <code>polymorphism.dta</code> :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        use data/polymorphism
list in 1/5
</pre>
                    </div>
                    <pre class="example">



     +---------------------+
     | id   age   genotype |
     |---------------------|
  1. |  1    43    1.6/1.6 |
  2. |  2    47    1.6/1.6 |
  3. |  3    55    1.6/1.6 |
  4. |  4    57    1.6/1.6 |
  5. |  5    61    1.6/1.6 |
     +---------------------+
</pre>
                    <p>Un résumé descriptif des données de groupe
                    (ici défini par le type de polymorphisme) peut
                    être obtenu très rapidement à l’aide de
                    <a href="https://www.stata.com/help.cgi?tabstat">
                    tabstat</a> :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        tabstat age, by(genotype) stat(mean sd n)
</pre>
                    </div>
                    <pre class="example">


Summary for variables: age
     by categories of: genotype (Genotype)

genotype |      mean        sd         N
---------+------------------------------
 1.6/1.6 |  64.64286  11.18108        14
 1.6/0.7 |  64.37931  13.25954        29
 0.7/0.7 |    50.375  10.63877        16
---------+------------------------------
   Total |  60.64407  13.49427        59
----------------------------------------
</pre>
                    <p>Un résumé graphique de la distribution
                    conditionnelle de l’âge dans les trois groupes
                    s’obtient tout aussi simplement à l’aide de
                    <a href=
                    "https://www.stata.com/help.cgi?graph%20box">graph
                    box</a> :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        set scheme plotplain
graph box age, over(genotype)
graph export "fig-04-boxplot-age-genotype.svg", replace
</pre>
                    </div>
                    <div id="org9c6331f" class="figure">
                        <p><object type="image/svg+xml" data=
                        "./fig-04-boxplot-age-genotype.svg" class=
                        "org-svg" width="640px">
                            Sorry, your browser does not support
                            SVG.
                        </object></p>
                        <p><span class=
                        "figure-number">Figure&nbsp;1&nbsp;:</span>
                        Distribution de l’âge de diagnostic en
                        fonction du polymorphisme</p>
                    </div>
                    <p>Il est également possible d’afficher ces
                    distributions sous forme d’histogrammes
                    d’effectifs ou de fréquences, par exemple :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        histogram age, by(genotype, col(3)) freq
graph export "fig-04-hist-age-genotype.svg", replace
</pre>
                    </div>
                    <div id="org5dbbadb" class="figure">
                        <p><object type="image/svg+xml" data=
                        "./fig-04-hist-age-genotype.svg" class=
                        "org-svg" width="640px">
                            Sorry, your browser does not support
                            SVG.
                        </object></p>
                        <p><span class=
                        "figure-number">Figure&nbsp;2&nbsp;:</span>
                        Distribution de l’âge de diagnostic en
                        fonction du polymorphisme</p>
                    </div>
                    <p>Le tableau d’ANOVA peut être constuit à
                    l’aide de <a href=
                    "https://www.stata.com/help.cgi?oneway">oneway</a>
                    dans le cas où il n’y a qu’une seule variable
                    explicative. L’option <code>tabulate</code>
                    fournit exactement le même résumé numérique que
                    la commande <a href=
                    "https://www.stata.com/help.cgi?tabstat">tabstat</a>
                    ci-dessus, tandis que l’option
                    <code>bonferonni</code> ajoute la comparaison
                    de l’ensemble des paires de moyennes avec une
                    correction de Bonferroni pour les tests
                    multiples. Si l’on ne souhaite que ces
                    derniers, il suffit d’ajouter l’option
                    <code>noanova</code>, mais en règle générale il
                    est préférable de réaliser le test d’ensemble
                    avant d’examiner les tests spécifiques, sauf si
                    l’on a une hypothèse de recherche très
                    particulière.</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        oneway age genotype
</pre>
                    </div>
                    <pre class="example">

                        Analysis of Variance
    Source              SS         df      MS            F     Prob &gt; F
------------------------------------------------------------------------
Between groups      2315.73355      2   1157.86678      7.86     0.0010
 Within groups      8245.79187     56   147.246283
------------------------------------------------------------------------
    Total           10561.5254     58   182.095266

Bartlett's test for equal variances:  chi2(2) =   1.0798  Prob&gt;chi2 = 0.583
</pre>
                </div>
            </div>
            <div id="outline-container-org02a761a" class=
            "outline-3">
                <h3 id="org02a761a">Conditions d’application du
                test</h3>
                <div class="outline-text-3" id="text-org02a761a">
                    <p>Il est généralement recommendé de vérifier
                    les hypothèses du modèle, en particulier celle
                    portant sur l’égalité des variances parentes,
                    de manière graphique. Notons que <a href=
                    "https://www.stata.com/help.cgi?oneway">oneway</a>
                    propose d’office un test formel d’égalité des
                    variances (test de Bartlett). Le test de
                    Levenne est disponible via la commande <a href=
                    "https://www.stata.com/help.cgi?robvar">robvar</a>
                    (statistique <code>W50</code>) :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        robvar age, by(genotype)
</pre>
                    </div>
                    <pre class="example">

            |     Summary of Age at Diagnosis
   Genotype |        Mean   Std. Dev.       Freq.
------------+------------------------------------
    1.6/1.6 |   64.642857   11.181077          14
    1.6/0.7 |    64.37931   13.259535          29
    0.7/0.7 |      50.375   10.638766          16
------------+------------------------------------
      Total |   60.644068   13.494268          59

W0  =  0.83032671   df(2, 56)     Pr &gt; F = 0.44120161

W50 =  0.60460508   df(2, 56)     Pr &gt; F = 0.54981692

W10 =  0.79381598   df(2, 56)     Pr &gt; F = 0.45713722
</pre>
                    <p>Concernant la normalité des distributions
                    (parentes), à partir de l’échantillon il est
                    toujours possible de tracer la fonction de
                    répartition des observations, un histogramme ou
                    un diagramme de type boîte à moustaches (cf.
                    section suivante). La commande <a href=
                    "https://www.stata.com/help.cgi?swilk">swilk</a>
                    fournit le test de Shapiro-Wilks, mais comme
                    les méthodes graphiques restent à privilégier,
                    voici une façon de vérifier la normalité des
                    résidus du modèle (dans le cas de l’ANOVA à un
                    facteur, cela ne change pas grand-chose par
                    rapport au fait de travailler sur les
                    observations directement, mais dans le cas à
                    plus d’un facteur en interaction c’est la
                    méthode recommendée) :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        quietly anova age genotype
predict r, resid
qnorm r
graph export "fig-04-qnorm-age-genotype-resid.svg", replace
</pre>
                    </div>
                    <div id="orgb5b8a2b" class="figure">
                        <p><object type="image/svg+xml" data=
                        "./fig-04-qnorm-age-genotype-resid.svg"
                        class="org-svg" width="640px">
                            Sorry, your browser does not support
                            SVG.
                        </object></p>
                        <p><span class=
                        "figure-number">Figure&nbsp;3&nbsp;:</span>
                        Distribution des résidus du modèle
                        d’ANOVA</p>
                    </div>
                </div>
            </div>
            <div id="outline-container-org5cac94e" class=
            "outline-3">
                <h3 id="org5cac94e">Commandes graphiques</h3>
                <div class="outline-text-3" id="text-org5cac94e">
                    <p>Stata n’offre pas vraiment de commandes
                    graphiques de post-estimation à l’exception de
                    celles applicables au cas du modèle linéaire,
                    telles que les graphiques de résidus en
                    fonction des valeurs prédites ou observées. Il
                    existe toutefois de nombreux packages
                    disponibles sur le site SSC, en particulier la
                    commande <code>anovaplot</code> (une approche
                    manuelle pour construire un graphique
                    d’interaction est présentée dans la section
                    suivante).</p>
                    <p>Une référence intéressante concernant les
                    approches graphiques pour le diagnostique des
                    modèles de régression, au sens large, est
                    l’article de [<a href=
                    "#cox-2004-speakin-stata">2</a>].</p>
                </div>
            </div>
            <div id="outline-container-orgf3f330a" class=
            "outline-3">
                <h3 id="orgf3f330a">Comparaisons multiples</h3>
                <div class="outline-text-3" id="text-orgf3f330a">
                    <p>Lorsque le résultat du test d’ANOVA est
                    significatif, il est souvent intéressant, voire
                    nécessaire d’aller inspecter le résultat des
                    comparaisons de chaque paire de moyennes. Comme
                    indiqué plus haut, il est déconseillé de
                    procéder à de telles comparaisons multiples
                    lorsque l’ANOVA n’est en elle-même pas
                    significative puisque dans ce cas il s’agit un
                    peu de ce que l’on appelle du «&nbsp;data
                    fishing&nbsp;». Cela dit, dans certains cas de
                    figure, il est possible de pré-spécifier les
                    comparaisons d’intérêt et de n’analyser que ces
                    contrastes d’intérêt. Dans ce cas, le modèle
                    d’ANOVA est même facultatif.</p>
                    <p>Il y a deux manières de procéder pour
                    réaliser des comparaisons de paires de moyennes
                    sous Stata (outre la comparaison manuelle à
                    l’aide de <a href=
                    "https://www.stata.com/help.cgi?ttest">ttest</a>):
                    (1) la commande <a href=
                    "https://www.stata.com/help.cgi?oneway">oneway</a>
                    offre une option permettant de tester les
                    paires de moyennes et d’appliquer une
                    correction pour borner le risque d’erreur
                    d’ensemble (<i>FWER</i>) ; (2) les commandes
                    <a href=
                    "https://www.stata.com/help.cgi?pwcompare">pwcompare</a>,
                    <a href=
                    "https://www.stata.com/help.cgi?contrast">contrast</a>
                    ou <a href=
                    "https://www.stata.com/help.cgi?lincome">lincome</a>
                    (ou <a href=
                    "https://www.stata.com/help.cgi?test">test</a>).
                    La commande <a href=
                    "https://www.stata.com/help.cgi?margins">margins</a>
                    fournit plus de souplesse dans l’estimation
                    conditionnelle ou marginale des effets et
                    permet en outre la représentation graphique
                    des résultats grâce à <a href=
                    "https://www.stata.com/help.cgi?marginsplot">marginsplot</a>.
                    En dehors de <a href=
                    "https://www.stata.com/help.cgi?pwcompare">pwcompare</a>,
                    les autres commandes restent applicables dans
                    le cas du modèle linéaire dans son
                    ensemble.</p>
                    <p>Voici le résultat des tests multiples à
                    partir de <a href=
                    "https://www.stata.com/help.cgi?oneway">oneway</a>
                    :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        oneway age genotype, bonferroni noanova
</pre>
                    </div>
                    <pre class="example">

                  Comparison of Age at Diagnosis by Genotype
                                (Bonferroni)
Row Mean-|
Col Mean |    1.6/1.6    1.6/0.7
---------+----------------------
 1.6/0.7 |   -.263547
         |      1.000
         |
 0.7/0.7 |   -14.2679   -14.0043
         |      0.007      0.001
</pre>
                    <p>On arriverait naturellement aux mêmes
                    conclusions en construisant manuellement les
                    tests de Student correspondants, moyennant la
                    prise en compte de la bonne somme de carrés
                    (variance «&nbsp;poolée&nbsp;») :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        quietly ttest age if genotype != 1, by(genotype)
display r(p)*3
</pre>
                    </div>
                    <pre class="example">


.00228566
</pre>
                </div>
            </div>
            <div id="outline-container-orgb5487dc" class=
            "outline-3">
                <h3 id="orgb5487dc">Cas des variances non
                égales</h3>
                <div class="outline-text-3" id="text-orgb5487dc">
                    <p>Plusieurs généralisations du test de Welch
                    dans le cas où les variances ne sont pas égales
                    ont été proposées [<a href=
                    "#welch-1951-compar-sever">3</a>]. Sous Stata,
                    les procédures <code>wtest</code> et
                    <code>fstar</code> peuvent être téléchargées.
                    Voici un exemple d’application avec
                    <code>wtest,</code> dont les auteurs ont montré
                    que cette statistique de test convient dans le
                    cas où les échantillons sont de même taille (ce
                    n’est pas vraiment le cas ici) mais de variance
                    différente [<a href=
                    "#wilcox-1986-new-monte">4</a>] :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        wtest age genotype
</pre>
                    </div>
                    <pre class="example">

----------------------------------------------------------------------
Dependent Variable is age and Independent Variable is genotype
WStat(  2,  31.91) =   9.129, p= 0.0007
----------------------------------------------------------------------
</pre>
                </div>
            </div>
            <div id="outline-container-org4a5d162" class=
            "outline-3">
                <h3 id="org4a5d162">Approche non paramétrique</h3>
                <div class="outline-text-3" id="text-org4a5d162">
                    <p>L’ANOVA de Kruskal-Wallis, qui généralise la
                    commande <a href=
                    "https://www.stata.com/help.cgi?ranksum">ranksum</a>
                    au cas à plus de deux échantillons, est
                    disponible via la commande <a href=
                    "https://www.stata.com/help.cgi?kwallis">kwallis</a>
                    :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        kwallis age, by(genotype)
</pre>
                    </div>
                    <pre class="example">

Kruskal-Wallis equality-of-populations rank test

  +---------------------------+
  | genotype | Obs | Rank Sum |
  |----------+-----+----------|
  |  1.6/1.6 |  14 |   494.00 |
  |  1.6/0.7 |  29 |   999.50 |
  |  0.7/0.7 |  16 |   276.50 |
  +---------------------------+

chi-squared =    12.060 with 2 d.f.
probability =     0.0024

chi-squared with ties =    12.073 with 2 d.f.
probability =     0.0024
</pre>
                    <p>Cette commande ne dispose pas d’option. On
                    peut retrouvera simplement les sommes des rangs
                    (voire les moyennes) utilisées dans ce test
                    statistique à l’aide des instructions suivantes
                    :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        egen rr = rank(age)
bysort genotype : egen rs = sum(rr)
tabdisp genotype, cellvar(rs) format(%3.1f)
</pre>
                    </div>
                    <pre class="example">




----------------------
 Genotype |         rs
----------+-----------
  1.6/1.6 |      494.0
  1.6/0.7 |      999.5
  0.7/0.7 |      276.5
----------------------
</pre>
                    <p>Il est également possible de coupler cette
                    instruction avec une série de tests post-hoc de
                    Mann-Whitney, comme illustré ci-dessous :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        foreach k of numlist 1/3 {
  quietly ranksum age if genotype != `k', by(genotype)
  display r(z), "(p=" 2*(1-normal(r(z))) ")"
}
</pre>
                    </div>
                    <pre class="example">

3.1199701 (p=.00180869)
2.9974171 (p=.00272278)
.05188301 (p=.95862192)
</pre>
                </div>
            </div>
        </div>
        <div id="outline-container-org74392c2" class="outline-2">
            <h2 id="org74392c2">Analyse de variance à plusieurs
            facteurs</h2>
            <div class="outline-text-2" id="text-org74392c2"></div>
            <div id="outline-container-orgcac23ed" class=
            "outline-3">
                <h3 id="orgcac23ed">Utilisation de la commande
                anova</h3>
                <div class="outline-text-3" id="text-orgcac23ed">
                    <p>La commande <a href=
                    "https://www.stata.com/help.cgi?oneway">oneway</a>
                    est limité au cas à un facteur explicatif. La
                    commande <a href=
                    "https://www.stata.com/help.cgi?anova">anova</a>
                    est plus générale et couvre : les plans
                    factoriels et emboîtés, les plans
                    équilibrés ou non (cf. calcul des sommes de
                    carrés), les mesures répétées, l’analyse de
                    covariance. Dans le cas à un facteur à effet
                    fixe, on retrouvera évidemment les mêmes
                    résultats que plus haut :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        anova age genotype
</pre>
                    </div>
                    <pre class="example">

                         Number of obs =         59    R-squared     =  0.2193
                         Root MSE      =    12.1345    Adj R-squared =  0.1914

                  Source | Partial SS         df         MS        F    Prob&gt;F
              -----------+----------------------------------------------------
                   Model |  2315.7336          2   1157.8668      7.86  0.0010
                         |
                genotype |  2315.7336          2   1157.8668      7.86  0.0010
                         |
                Residual |  8245.7919         56   147.24628  
              -----------+----------------------------------------------------
                   Total |  10561.525         58   182.09527  
</pre>
                    <p>Les comparaisons par paires de moyennes
                    s’obtiennent à l’aide de <a href=
                    "https://www.stata.com/help.cgi?pwcompare">pwcompare</a>,
                    commande plus générale que <a href=
                    "https://www.stata.com/help.cgi?pwmean">pwmean</a>.
                    Les options de correction
                    (<code>mcompare()</code>) incluent en plus :
                    <code>tukey</code>, <code>snk</code>,
                    <code>duncan</code> et
                    <code>dunnett</code>.</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        pwcompare genotype, cformat(%3.2f)
</pre>
                    </div>
                    <pre class="example">

Pairwise comparisons of marginal linear predictions

Margins      : asbalanced

---------------------------------------------------------------------
                    |                                 Unadjusted
                    |   Contrast   Std. Err.     [95% Conf. Interval]
--------------------+------------------------------------------------
           genotype |
1.6/0.7 vs 1.6/1.6  |      -0.26       3.95         -8.17        7.65
0.7/0.7 vs 1.6/1.6  |     -14.27       4.44        -23.16       -5.37
0.7/0.7 vs 1.6/0.7  |     -14.00       3.78        -21.57       -6.43
---------------------------------------------------------------------
</pre>
                    <p>Voici un exemple de plan d’expérience dans
                    lequel on s’intéresse à la fabrication d’une
                    batterie capable de fonctionner dans des
                    conditions extrêmes de température [<a href=
                    "#montgomery-2001-desig-analy-exper">5</a>].
                    Cette étude comprend deux facteurs
                    expérimentaux ayant trois niveaux chacun : la
                    température (°F) et un paramètre lié au design
                    de la batterie elle-même. Il s’agit donc d’un
                    plan factoriel \(3^2\). Les données sont
                    disponibles dans le fichier
                    <code>battery.txt</code>.</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        import delimited "data/battery.txt", delimiter("", collapse) varnames(1) clear
list in 1/3
</pre>
                    </div>
                    <pre class="example">

(3 vars, 36 obs)


     +----------------------------+
     | life   material   temper~e |
     |----------------------------|
  1. |  130          1         15 |
  2. |   74          1         15 |
  3. |  155          1         15 |
     +----------------------------+
</pre>
                    <p>Voici les résultats pour le modèle avec
                    interaction :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        anova life material##temperature
</pre>
                    </div>
                    <pre class="example">

                         Number of obs =         36    R-squared     =  0.7652
                         Root MSE      =    25.9849    Adj R-squared =  0.6956

                  Source | Partial SS         df         MS        F    Prob&gt;F
    ---------------------+----------------------------------------------------
                   Model |  59416.222          8   7427.0278     11.00  0.0000
                         |
                material |  10683.722          2   5341.8611      7.91  0.0020
             temperature |  39118.722          2   19559.361     28.97  0.0000
    material#temperature |  9613.7778          4   2403.4444      3.56  0.0186
                         |
                Residual |   18230.75         27   675.21296  
    ---------------------+----------------------------------------------------
                   Total |  77646.972         35   2218.4849  
</pre>
                    <p>On rappelle que le modèle à effets pour ce
                    type d’ANOVA s’écrit :</p>
                    <p>\[
                    y_{ijk}=\mu+\tau_i+\beta_j+(\tau\beta)_{ij}+\varepsilon_{ijk},
                    \]</p>
                    <p>où \(i\), \(j\) (\(i=1\dots a\), \(j=1\dots
                    b\)) décrivent les niveaux des facteurs \(A\)
                    et \(B\), et \(k\) représente le numéro
                    d’observation (\(k=1\dots n\)). L’ordre dans
                    lequel les observations sont choisies est tiré
                    au sort, de sorte que l’on parle d’un plan
                    complètement randomisé. On distingue \(a+b+1\)
                    dépendances linéaires dans ce système
                    d’équations, et par conséquent les paramètres
                    ne peuvent être identifiés sans imposer
                    certaines contraintes. En règle générale, on
                    impose \(\sum_{i=1}^a\hat{\tau}_i=0\),
                    \(\sum_{j=1}^b\hat{\beta}_j=0\),
                    \(\sum_{i=1}^a\widehat{\tau\beta}_{ij}=0\)
                    (\(j=1,2,\dots,b\)) et
                    \(\sum_{j=1}^b\widehat{\tau\beta}_{ij}=0\)
                    (\(i=1,2,\dots,a\)). On montre avec un peu
                    d’algèbre que l’équation ci-dessus peut être
                    exprimée sous la forme d’une somme corrigée de
                    sommes de carrés :</p>
                    <p>\[ \begin{split}
                    \sum_{i=1}^a\sum_{j=1}^b\sum_{k=1}^n(y_{ijk}-\bar{y}_{\cdot\cdot\cdot})^2
                    &amp;= \sum_{i=1}^a\sum_{j=1}^b\sum_{k=1}^n[
                    (\bar{y}_{i\cdot\cdot}-\bar{y}_{\cdot\cdot\cdot})+(\bar{y}_{\cdot
                    j\cdot}-\bar{y}_{\cdot\cdot\cdot}) \\ & \quad +
                    (\bar{y}_{ij\cdot}-\bar{y}_{i\cdot\cdot}-\bar{y}_{\cdot
                    j\cdot}+\bar{y}_{\cdot\cdot\cdot})+(y_{ijk}-\bar{y}_{ij\cdot})]^2\\
                    &amp;=
                    bn\sum_{i=1}^a(\bar{y}_{i\cdot\cdot}-\bar{y}_{\cdot\cdot\cdot})^2+an\sum_{j=1}^b(\bar{y}_{\cdot
                    j\cdot}-\bar{y}_{\cdot\cdot\cdot})^2 \\ & \quad
                    +
                    n\sum_{i=1}^a\sum_{j=1}^b(\bar{y}_{ij\cdot}-\bar{y}_{i\cdot\cdot}-\bar{y}_{\cdot
                    j\cdot}+\bar{y}_{\cdot\cdot\cdot})^2\\ & \quad
                    +
                    \sum_{i=1}^a\sum_{j=1}^b\sum_{k=1}^n(y_{ijk}-\bar{y}_{ij\cdot})^2
                    \end{split} \]</p>
                    <p>Sous forme symbolique, et on retrouve la
                    formule passée en arguments de <a href=
                    "https://www.stata.com/help.cgi?anova">anova</a>
                    (sans la résiduelle), on a bien
                    \(SS_T=SS_A+SS_B+SS_{AB}+SS_E\). Les hypothèses
                    associées à ce type de plan portent
                    généralement sur les effets principaux et sur
                    l’effet d’interaction :</p>
                    <ul class="org-ul">
                        <li>égalité des effets du traitement en
                        lignes, \(H_0:\;
                        \tau_1=\tau_2=\dots=\tau_a=0\) ;</li>
                        <li>égalité des effets du traitement en
                        colonnes, \(H_0:\;
                        \beta_1=\beta_2=\dots=\beta_b=0\) ;</li>
                        <li>absence d’interaction entre les
                        traitements en lignes et en colonnes,
                        \(H_0:\; (\tau\beta)_{ij}=0\quad
                        \textrm{for all}\; i,j\).</li>
                    </ul>
                    <p>Voici le tableau résumant les moyennes pour
                    chaque traitement, ainsi que les écart-types et
                    effectifs associés. On pourra vérifier que le
                    plan est parfaitement équilibré :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        table material temperature, contents(mean life sd life n life) format(%4.1f)
</pre>
                    </div>
                    <pre class="example">


-------------------------------
          |     Temperature    
 Material |    15     70    125
----------+--------------------
        1 | 134.8   57.2   57.5
          |  45.4   23.6   26.9
          |     4      4      4
          | 
        2 | 155.8  119.8   49.5
          |  25.6   12.7   19.3
          |     4      4      4
          | 
        3 | 144.0  145.8   85.5
          |  26.0   22.5   19.3
          |     4      4      4
-------------------------------
</pre>
                    <p>Un graphique d’interaction permettant
                    d’illustrer les variations de moyennes entre
                    les conditions pourrait être constuit à l’aide
                    de <a href=
                    "https://www.stata.com/help.cgi?scatter">scatter</a>
                    comme suit :</p>
                    <pre class="example">
preserve
collapse (mean) mean=life (sd) sd=life, by(material temperature)
list in 1/3
drop sd
reshape wide mean, i(temperature) j(material)
twoway connected mean* temperature, legend(label(1 "#1") label(2 "#2") label(3 "#3")) ytitle(Mean life)
graph export "fig-04-scatter-life-battery.svg", replace
restore
</pre>
                    <p>Il existe également les commandes <a href=
                    "https://www.stata.com/help.cgi?rcap">rcap</a>
                    et <a href=
                    "https://www.stata.com/help.cgi?serrbar">serrbar</a>
                    pour gérer les barres d’erreur. Toutefois la
                    commande <a href=
                    "https://www.stata.com/help.cgi?marginplot">marginplot</a>
                    est beaucoup plus souple d’utilisation et elle
                    s’interface directement avec les modèles
                    statistiques les plus courants. Voici une
                    exemple de son utilisation avec le modèle
                    précédent :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        quietly margins temperature#material
marginsplot, name(p)
graph export "fig-04-margins-life-battery.svg", replace name(p)
</pre>
                    </div>
                    <div id="orgd319d51" class="figure">
                        <p><object type="image/svg+xml" data=
                        "./fig-04-margins-life-battery.svg" class=
                        "org-svg" width="640px">
                            Sorry, your browser does not support
                            SVG.
                        </object></p>
                        <p><span class=
                        "figure-number">Figure&nbsp;4&nbsp;:</span>
                        Graphique d’interaction avec la commande
                        marginsplot</p>
                    </div>
                </div>
            </div>
            <div id="outline-container-org5da5c3a" class=
            "outline-3">
                <h3 id="org5da5c3a">Définition et analyse de
                contrastes</h3>
                <div class="outline-text-3" id="text-org5da5c3a">
                    <p>Voyons ce que l’on peut réaliser en termes
                    de tests de contrastes à l’aide de <a href=
                    "https://www.stata.com/help.cgi?pwcompare">pwcompare</a>.
                    Dans un premier temps, la comparaison de
                    l’ensemble des paires de moyennes peut être
                    réalisée en décomposant le terme d’interaction,
                    et en utilisant la méthode de Tukey comme
                    correction pour les tests multiples :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        pwcompare material#temperature, mcompare(tukey)
</pre>
                    </div>
                    <pre class="example">

Pairwise comparisons of marginal linear predictions

Margins      : asbalanced

-----------------------------------
                     |    Number of
                     |  Comparisons
---------------------+-------------
material#temperature |           36
-----------------------------------

----------------------------------------------------------------------
                     |                                   Tukey
                     |   Contrast   Std. Err.     [95% Conf. Interval]
---------------------+------------------------------------------------
material#temperature |
 (1  70) vs (1  15)  |      -77.5   18.37407     -139.3232   -15.67681
 (1 125) vs (1  15)  |     -77.25   18.37407     -139.0732   -15.42681
 (2  15) vs (1  15)  |         21   18.37407     -40.82319    82.82319
 (2  70) vs (1  15)  |        -15   18.37407     -76.82319    46.82319
 (2 125) vs (1  15)  |     -85.25   18.37407     -147.0732   -23.42681
 (3  15) vs (1  15)  |       9.25   18.37407     -52.57319    71.07319
 (3  70) vs (1  15)  |         11   18.37407     -50.82319    72.82319
 (3 125) vs (1  15)  |     -49.25   18.37407     -111.0732    12.57319
 (1 125) vs (1  70)  |        .25   18.37407     -61.57319    62.07319
 (2  15) vs (1  70)  |       98.5   18.37407      36.67681    160.3232
 (2  70) vs (1  70)  |       62.5   18.37407      .6768132    124.3232
 (2 125) vs (1  70)  |      -7.75   18.37407     -69.57319    54.07319
 (3  15) vs (1  70)  |      86.75   18.37407      24.92681    148.5732
 (3  70) vs (1  70)  |       88.5   18.37407      26.67681    150.3232
 (3 125) vs (1  70)  |      28.25   18.37407     -33.57319    90.07319
 (2  15) vs (1 125)  |      98.25   18.37407      36.42681    160.0732
 (2  70) vs (1 125)  |      62.25   18.37407      .4268132    124.0732
 (2 125) vs (1 125)  |         -8   18.37407     -69.82319    53.82319
 (3  15) vs (1 125)  |       86.5   18.37407      24.67681    148.3232
 (3  70) vs (1 125)  |      88.25   18.37407      26.42681    150.0732
 (3 125) vs (1 125)  |         28   18.37407     -33.82319    89.82319
 (2  70) vs (2  15)  |        -36   18.37407     -97.82319    25.82319
 (2 125) vs (2  15)  |    -106.25   18.37407     -168.0732   -44.42681
 (3  15) vs (2  15)  |     -11.75   18.37407     -73.57319    50.07319
 (3  70) vs (2  15)  |        -10   18.37407     -71.82319    51.82319
 (3 125) vs (2  15)  |     -70.25   18.37407     -132.0732   -8.426813
 (2 125) vs (2  70)  |     -70.25   18.37407     -132.0732   -8.426813
 (3  15) vs (2  70)  |      24.25   18.37407     -37.57319    86.07319
 (3  70) vs (2  70)  |         26   18.37407     -35.82319    87.82319
 (3 125) vs (2  70)  |     -34.25   18.37407     -96.07319    27.57319
 (3  15) vs (2 125)  |       94.5   18.37407      32.67681    156.3232
 (3  70) vs (2 125)  |      96.25   18.37407      34.42681    158.0732
 (3 125) vs (2 125)  |         36   18.37407     -25.82319    97.82319
 (3  70) vs (3  15)  |       1.75   18.37407     -60.07319    63.57319
 (3 125) vs (3  15)  |      -58.5   18.37407     -120.3232    3.323187
 (3 125) vs (3  70)  |     -60.25   18.37407     -122.0732    1.573187
----------------------------------------------------------------------
</pre>
                    <p>Le test d’un contraste spécifique peut être
                    réalisé tout aussi simplement, en indiquant le
                    niveau du ou des facteurs qui nous intéressent,
                    ainsi que les degrés de liberté associés :</p>
                    <div class="org-src-container">
                        <pre class="src src-jupyter-stata">
                        pwcompare i2.material#i3.temperature, mcompare(tukey) df(34)
</pre>
                    </div>
                    <pre class="example">
level 3 of factor temperature not found in list of covariates
r(111);

</pre>
                    <p>Des <a href=
                    "https://stats.idre.ucla.edu/stata/faq/how-can-i-do-power-and-robustness-analyses-for-factorial-anova-stata-11/">
                    simulations de Monte Carlo</a> permettent
                    évaluer la puissance statistique d’un plan
                    factoriel, en spécifiant les valeurs attendues
                    pour les moyennes et variances dans chacune des
                    conditions expérimentales. Il ne s’agit donc
                    pas d’un calcul de puissance <i>a
                    posteriori</i>.</p>
                </div>
            </div>
        </div>
        <div id="outline-container-org87b5f58" class="outline-2">
            <h2 id="org87b5f58">Autres plans d’expérience</h2>
            <div class="outline-text-2" id="text-org87b5f58"></div>
            <div id="outline-container-org64d1305" class=
            "outline-3">
                <h3 id="org64d1305">Plan en carré latin</h3>
            </div>
            <div id="outline-container-orga7d88ff" class=
            "outline-3">
                <h3 id="orga7d88ff">Plan en blocs incomplets
                équilibrés</h3>
                <div class="outline-text-3" id="text-orga7d88ff">
                    <p>Les plans en blocs incomplets équilibrés
                    (BIBD en anglais) font partie des plans en
                    blocs aléatoires dans lesquels certains
                    traitements ne sont pas observés pour certains
                    blocs ou combinaisons de blocs. Si l’on note
                    \(a\) le nombre de traitements, et \(k\) le
                    nombre maximum de traitements dans chaque bloc
                    (\(k &lt; a\)), alors un plan BIBD se résume à
                    un arrangement de \(a \choose k\) combinaisons
                    [<a href="#hinkelmann-2005-design">6</a>].</p>
                    <p>Voici un exemple discuté par Montgomery,
                    chapitre 4 [<a href=
                    "#montgomery-2001-desig-analy-exper">5</a>]
                    :</p>
                    <table id="org0b14b2b" border="2" rules="all"
                    frame="border" width="100%">
                        <caption class="t-above">
                            <span class="table-number">Tableau 1
                            :</span> Résultats d’une expérience de
                            catalyse (Tableau 4–21)
                        </caption>
                        <colgroup>
                            <col class="org-right">
                            <col class="org-right">
                            <col class="org-right">
                            <col class="org-right">
                            <col class="org-right">
                            <col class="org-right">
                        </colgroup>
                        <thead>
                            <tr>
                                <th scope="col" class="org-right">
                                Traitement</th>
                                <th scope="col" class="org-right">
                                1</th>
                                <th scope="col" class="org-right">
                                2</th>
                                <th scope="col" class="org-right">
                                3</th>
                                <th scope="col" class="org-right">
                                4</th>
                                <th scope="col" class="org-right">
                                \(y_{i\cdot}\)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="org-right">1</td>
                                <td class="org-right">73</td>
                                <td class="org-right">74</td>
                                <td class="org-right">--</td>
                                <td class="org-right">71</td>
                                <td class="org-right">218</td>
                            </tr>
                            <tr>
                                <td class="org-right">2</td>
                                <td class="org-right">--</td>
                                <td class="org-right">75</td>
                                <td class="org-right">67</td>
                                <td class="org-right">72</td>
                                <td class="org-right">214</td>
                            </tr>
                            <tr>
                                <td class="org-right">3</td>
                                <td class="org-right">73</td>
                                <td class="org-right">75</td>
                                <td class="org-right">68</td>
                                <td class="org-right">--</td>
                                <td class="org-right">216</td>
                            </tr>
                            <tr>
                                <td class="org-right">4</td>
                                <td class="org-right">75</td>
                                <td class="org-right">--</td>
                                <td class="org-right">72</td>
                                <td class="org-right">75</td>
                                <td class="org-right">222</td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr>
                                <td class="org-right">\(y_{\cdot
                                j}\)</td>
                                <td class="org-right">221</td>
                                <td class="org-right">224</td>
                                <td class="org-right">207</td>
                                <td class="org-right">218</td>
                                <td class="org-right">
                                \(870=y_{\cdot\cdot}\)</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Si l’on considère qu’il y a \(a\)
                    traitements et \(b\) blocs, et que chaque bloc
                    consiste en \(k\) traitements, avec \(r\)
                    répliques au total dans le plan, alors on a \(N
                    = ar = bk\) observations, et le nombre de fois
                    où chaque paire de traitement apparaît dans le
                    même bloc vaut \(\lambda =
                    \frac{r(k-1)}{a-1}\), \(\lambda\in
                    \{0,1,2,\dots\}\). Si \(a = b\), le plan est
                    dit symétrique. <sup><a id="fnr.1" class=
                    "footref" href="#fn.1">1</a></sup></p>
                    <div id="bibliography">
                        <h2>Références</h2>
                        <table>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "dupont-2009-statis-model" id=
                                    "dupont-2009-statis-model">1</a>]
                                </td>
                                <td class="bibtexitem">W.&nbsp;D.
                                Dupont, <em>Statistical Modeling
                                for Biomedical Researchers</em>.
                                Cambridge University Press,
                                2nd&nbsp;ed., 2009.</td>
                            </tr>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "cox-2004-speakin-stata" id=
                                    "cox-2004-speakin-stata">2</a>]
                                </td>
                                <td class="bibtexitem">N.&nbsp;Cox,
                                “Speaking stata: Graphing model
                                diagnostics,” <em>The Stata
                                Journal</em>, vol.&nbsp;4,
                                no.&nbsp;4, pp.&nbsp;449--475,
                                2004.</td>
                            </tr>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "welch-1951-compar-sever" id=
                                    "welch-1951-compar-sever">3</a>]
                                </td>
                                <td class="bibtexitem">B.&nbsp;L.
                                Welch, “On the comparison of
                                several mean values: an alternative
                                approach,” <em>Biometrika</em>,
                                vol.&nbsp;38, p.&nbsp;330—336,
                                1951.</td>
                            </tr>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "wilcox-1986-new-monte" id=
                                    "wilcox-1986-new-monte">4</a>]
                                </td>
                                <td class="bibtexitem">
                                R.&nbsp;Wilcox, V.&nbsp;Charlin,
                                and K.&nbsp;Thompson, “New monte
                                carlo results on the robustness of
                                the anova f, w and f statistics,”
                                vol.&nbsp;15, no.&nbsp;4,
                                pp.&nbsp;933--943, 1986.</td>
                            </tr>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "montgomery-2001-desig-analy-exper"
                                    id=
                                    "montgomery-2001-desig-analy-exper">5</a>]
                                </td>
                                <td class="bibtexitem">D.&nbsp;C.
                                Montgomery, <em>Design and Analysis
                                of Experiments</em>. Wiley,
                                5&nbsp;ed., 2001.</td>
                            </tr>
                            <tr valign="top">
                                <td align="right" class=
                                "bibtexnumber">
                                    [<a name=
                                    "hinkelmann-2005-design" id=
                                    "hinkelmann-2005-design">6</a>]
                                </td>
                                <td class="bibtexitem">
                                K.&nbsp;Hinkelmann and
                                O.&nbsp;Kempthorne, <em>Design and
                                Analysis of Experiments.
                                Volume&nbsp;2: Advanced
                                Experimental Design</em>. John
                                Wiley & Sons, Inc., 2005.</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="footnotes">
            <h2 class="footnotes">Notes de bas de page:</h2>
            <div id="text-footnotes">
                <div class="footdef">
                    <sup><a id="fn.1" class="footnum" href=
                    "#fnr.1">1</a></sup>
                    <div class="footpara">
                        <p class="footpara">Comme \(\lambda\) est
                        forcément un entier, cela limite l’espace
                        des solutions pour certains plans. Par
                        exemple, les contraintes \(r=4\), \(t=4\),
                        \(b=8\) et \(k=2\) ne sont pas admissibles
                        dans un simple plan en blocs aléatoires,
                        mais restent valides dans le cas un plan en
                        blocs incomplets équilibrés.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="postamble" class="status">
        Generated by <a href=
        "https://www.gnu.org/software/emacs/">Emacs</a> 27.0.91
        (<a href="https://orgmode.org">Org</a> mode 9.4) on
        2020-10-15 Thu 09:52 (<a href=
        "mailto:chl@aliquote.org">chl@aliquote.org</a>)
    </div>
</body>
</html>
